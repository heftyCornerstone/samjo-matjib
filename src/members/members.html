    <html lang="ko"></html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>삼조 맛집 맴버들</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
            rel="stylesheet"> 
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">                                                                                                                                                                                                                        
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
        <link rel="stylesheet" href="./styles.css">
        <link rel="stylesheet" href="./defaultStyles.css">
    </head>

    <body>
        <!-- 네비게이션 -->
        <header id="navbar">
            <div>
                <img class="logo" src="./../images/logo.png" alt="삼조 맛집 로고">
            </div>
            <nav class="menuNav">
                <div id="menuUnderLine"></div>
                <ul class="menuUl">
                    <li class="menuLi"><a href="../../index.html">Team</a></li>
                    <li class="menuLi"><a href="members.html">Members</a></li>
                    <li class="menuLi"><a href="./../join/join.html">Join</a></li>
                </ul>
            </nav>
            <hr>
        </header>

        <!-- 콘텐츠 -->
        <div class="container">
            <div class="row" id="memCard">
                <!-- <div class="col col-md-4">
                    <div class="card">
                        <img
                            src="https://i.namu.wiki/i/R0AhIJhNi8fkU2Al72pglkrT8QenAaCJd1as-d_iY6MC8nub1iI5VzIqzJlLa-1uzZm--TkB-KHFiT-P-t7bEg.webp"
                            class="card-img-top"
                            alt="..."
                        />
                        <div class="card-body">
                            <div class="textArea">
                                <h5 class="card-name">테스트</h5>
                                <div class="material-symbols-outlined" id="deleteBtn">delete</div>
                            </div>
                            <h7 class="card-position">테스트</h7>
                        </div>
                    </div>
                </div> -->
            </div>    
        </div>
        <!-- 콘텐츠 -->

        <!-- 팝업창 -->
        <div class="overlay" id="popUp" style="display: none;">
        <div class="popup-box">
            <div class="photo">
                <img src="" class="popUpPhoto" alt="프로필 사진 이미지">
            </div>
            <div class="popUpCloseBtn material-symbols-outlined">
                    close
            </div>
            <div class="introArea">
                <div class="compound">
                    <div class="popUpTitle">이름</div>
                    <div class="bold memName"></div>
                </div>                
                <div class="compound">
                    <div class="popUpTitle">MBTI</div>
                    <div class="bold memMbti"></div>
                </div>
                <div class="compound">
                    <div class="popUpTitle">좋아하는 것</div>
                    <div class="bold memFavorites"></div>  
                </div>        
                <div class="compound">
                    <div class="popUpTitle">깃헙</div>
                    <a class="bold memGithub"></a>
                </div>                 
                <div class="compound">
                    <div class="popUpTitle">블로그</div>
                    <a class="bold memBlog"></a>
                </div>                
                <div class="compound">
                    <div class="popUpTitle">장점</div>
                    <div class="bold memMerit"></div>
                </div>

                <div class="compound">
                    <div class="popUpTitle">협업스타일</div>
                    <div class="bold memStyle"></div>
                </div>                             
            </div>
        </div>
        </div>
        <!-- 팝업창 -->

        <!-- 삭제 모달창-->
        <div class="overlay" id="member-delete" style="display: none;">
            <div class="modal">
                <div class="delete-title">정말 삭제하시겠습니까?</div>
                <div class="delete-description">맴버카드 삭제를 원하시면, 맴버 가입 시 생성했던 본인의 비밀번호를 입력해주시고, 삭제하기 버튼을 눌러주세요.</div>
                <div class="inputArea">
                    <div class="pw-name">비밀번호</div>
                    <input type="password" class="input-pw" placeholder="비밀번호를 입력해주세요." id="password">
                </div>
                <div class="btnArea">
                    <button class="deleteCardBtn yellowBtn">삭제하기</button>
                    <button class="cancelBtn1 cancelBtn">취소하기</button>
                </div>
            </div>
        </div>
        <div class="overlay" id="member-delete-successed" style="display: none;">
            <div class="modal" >
                <div class="shape">
                    <div class="result-title">맴버카드가 성공적으로</div>
                    <div class="result-title">삭제되었습니다!</div>
                </div>
                <button class="okayBtn yellowBtn">확인</button>
            </div>
        </div>
        <div class="overlay" id="member-delete-failed"  style="display: none;">
            <div class="modal">
                <div class="shape">
                    <div class="result-title">비밀번호가 틀렸습니다.</div>
                    <div class="result-title">다시 시도해주세요.</div>
                </div>
                <div class="btnArea">
                    <button class="tryAgainBtn yellowBtn">다시 입력하기</button>
                    <button class="cancelBtn2 cancelBtn">취소하기</button>
                </div>
            </div>
        </div>

        <!-- 푸터 -->
        <footer class="footer">
            <img class="gitCat" src="../images/git_cat_60^60.png" alt="Github Logo">
            <a class="footerA" href="https://github.com/heftyCornerstone/samjo-matjib">Team GitHub Link</a>
        </footer>
        <!-- 푸터 -->

        <script src="./script.js"></script>
        <script type="module">
            
            // Firebase SDK 라이브러리 가져오기
            import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
            import {
            getFirestore,
            collection,
            getDocs,
            doc,
            deleteDoc,
            } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

            // Firebase 구성 정보 설정
            const firebaseConfig = {
            apiKey: "AIzaSyB5lkGXDo4mwu2p0XxO1DEYVbmYJLkShcQ",
            authDomain: "samjo-matjib.firebaseapp.com",
            projectId: "samjo-matjib",
            storageBucket: "samjo-matjib.appspot.com",
            messagingSenderId: "664392711771",
            appId: "1:664392711771:web:543cb6323357fa4797497e",
            measurementId: "G-S6PG06CBL9",
            };

            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);

            async function loadMembers() {
            // firebase에서 데이터 가져오기
            let docs = await getDocs(collection(db, "members"));

            docs.forEach((docInfo) => {
                let row = docInfo.data();
                let name = row["name"];
                let photo = row["photo"];
                let mbti = row["mbti"];
                let merit = row["merit"];
                let coStyle = row["coStyle"];
                let fav = row["favorites"];
                let blog = row["blog"];
                let github = row["github"];
                const pw = row["pw"];

                let position = name === "박산하" ? "팀장" : "팀원"; // 팀장 조건

                // HTML 문자열 생성
                let temp_html = `
                <div class="col col-md-4">
                    <div class="card">
                    <img src="${photo}" class="card-img-top" alt="${name} 이미지" />
                    <div class="card-body">
                        <div class="textArea">
                        <h5 class="card-name">${name}</h5>
                        <div class="material-symbols-outlined deleteBtn">delete</div>
                        </div>
                        <h7 class="card-position">${position}</h7>
                    </div>
                    </div>
                </div>`;

                // temp_html 맴카드에 추가하기
                let card = $(temp_html).appendTo("#memCard");

                // 카드 클릭 시 팝업창에 데이터 삽입
                card.find(".card-img-top").on("click", function () {
                // 팝업창에 데이터 삽입
                $(".memName").text(name);
                $(".popUpPhoto").attr("src", photo);
                $(".memMbti").text(mbti);
                $(".memFavorites").text(fav);
                $(".memGithub").text(github);
                $(".memBlog").text(blog);
                $(".memGithub").attr("href", github);
                $(".memBlog").attr("href", blog);
                $(".memMerit").text(merit);
                $(".memStyle").text(coStyle);

                // 팝업창 서서히 자연스럽게 보이게하기
                $("#popUp").fadeIn();
                });

                // 닫기 버튼 클릭 시 자연스럽게 팝업창 닫기
                $(".popUpCloseBtn")
                .off("click")
                .on("click", function () {
                    $("#popUp").fadeOut();
                });

                // delete 기능 구현
                card.find(".deleteBtn").on("click", async function () {
                // 모달을 표시
                $("#member-delete").css("display", "flex");

                // 삭제 확인 모달에서 삭제 버튼 클릭 시
                $(".deleteCardBtn").on("click", async function () {
                    const enteredPassword = $("#password").val(); // 입력한 비밀번호 가져오기

                    if (enteredPassword === pw) {
                    const docId = docInfo.id;
                    try {
                        await deleteDoc(doc(db, "members", docId));

                        card.remove();

                        // 삭제 성공 모달 표시
                        $("#member-delete").css("display", "none");
                        $("#member-failed").css("display", "none");
                        $("#member-delete-successed").css("display", "flex");
                    } catch (error) {
                        console.error("에러메세지: ", error);
                        alert("카드 삭제에 실패했습니다.");
                    }
                    } else {
                    // 비밀번호가 틀린 경우 실패 모달을 띄움
                    $("#member-delete-successed").css("display", "none");
                    $("#member-delete").css("display", "none");
                    $("#member-delete-failed").css("display", "flex");
                    }
                });

                // 취소1 버튼을 눌렀을 때 삭제 확인 모달 닫기
                $(".cancelBtn1").on("click", function () {
                    $("#member-delete").css("display", "none");
                });

                // 삭제 성공 모달에서 확인 버튼을 눌렀을 때
                $(".okayBtn").on("click", function () {
                    $("#member-delete-successed").css("display", "none");
                });

                // 삭제 실패 모달에서 다시 입력 버튼을 눌렀을 때
                $(".tryAgainBtn").on("click", function () {
                    $("#member-delete-failed").css("display", "none");
                    $("#member-delete").css("display", "flex");
                });

                // 실패 모달에서 취소 버튼을 눌렀을 때
                $(".cancelBtn2").on("click", function () {
                    $("#member-delete-failed").css("display", "none");
                });
                });
            });
        }

        // 비동기 함수 호출
        loadMembers().catch(console.error);
        // 호출 시 문제 생기면 에러 확실히 알기 위해 catch 사용함...

        </script>
    </body>
</html>
